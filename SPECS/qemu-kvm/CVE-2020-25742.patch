diff --git a/hw/pci/pci.c b/hw/pci/pci.c
index cbc7a32..fa58e7a 100644
--- a/hw/pci/pci.c
+++ b/hw/pci/pci.c
@@ -255,6 +255,9 @@ static void pci_change_irq_level(PCIDevice *pci_dev, int irq_num, int change)
     PCIBus *bus;
     for (;;) {
         bus = pci_get_bus(pci_dev);
+        if (!bus) {
+            return;
+        }
         irq_num = bus->map_irq(pci_dev, irq_num);
         if (bus->set_irq)
             break;
